local spell = {}

spell.config = {
  [1] = {
    area = {
      [1] = {
        {1, 2, 0},
      },
      [2] = {
        {0, 3, 0},
      },

      [3] = {
        {0, 2, 1},
      },
      [4] = {
        {0, 2, 0},
        {0, 0, 1}
      },
      [5] = {
        {0, 2, 0},
        {0, 0, 0},
        {0, 0, 1},
      },
      [6] = {
        {0, 2, 0},
        {0, 0, 0},
        {0, 1, 0},
      },
      [7] = {
        {0, 2, 0},
        {0, 0, 0},
        {1, 0, 0}
      },
      [8] = {
        {0, 2, 0},
        {1, 0, 0}
      },
      [9] = {
        {1, 2, 0},
        {0, 0, 0}

      },
      [10] = {
        {0, 3, 0}
      },
      [11] = {
        {0,2, 1}
      },
    },
  },

  [2] = {
    area = {
      [1] = {
        {1, 2, 0},
      },
      [2] = {
        {0, 3, 0},
      },

      [3] = {
        {0, 2, 1},
      },
      [4] = {
        {0, 2, 0},
        {0, 0, 1}
      },
      [5] = {
        {0, 2, 0},
        {0, 0, 0},
        {0, 0, 1},
      },
      [6] = {
        {0, 2, 0},
        {0, 0, 0},
        {0, 1, 0},
      },
      [7] = {
        {0, 2, 0},
        {0, 0, 0},
        {1, 0, 0}
      },
      [8] = {
        {0, 2, 0},
        {1, 0, 0}
      },
      [9] = {
        {1, 2, 0},
        {0, 0, 0}

      },
      [10] = {
        {0, 3, 0}
      },
      [11] = {
        {0,2, 1}
      },
    },
  },
  [3] = {
    area = {
      [1] = {
        {0, 1, 0},
        {1, 1, 2},
      },
      [2] = {
        {0, 1, 0},
        {0, 3, 0},
      },

      [3] = {
        {0, 1},
        {2, 1},
      },
      [4] = {
        {2, 0, 1},
        {0, 1, 1}

      },
      [5] = {
        {2, 0, 0},
        {0, 0, 0},
        {0, 1, 1},
        {0, 1, 0}
      },
      [6] = {
        {0, 2, 0},
        {0, 0, 0},
        {0, 1, 0},
        {0, 1, 0}
      },
      [7] = {
        {0, 0, 2},
        {0, 0, 0},
        {1, 1, 0},
        {0, 1, 0},
      },
      [8] = {
        {0, 0, 2},
        {1, 1, 0},

      },
      [9] = {
        {0, 1, 0},
        {1, 1, 2},

      },
      [10] = {
        {0, 1, 0},
        {0, 3, 0},

      },

      [11] = {
        {0, 0, 1},
        {0, 2, 1}

      },
    }
  },
  [4] = {
    area = {
      [1] = {
        {0, 0, 1, 0},
        {0, 1, 1, 0},
        {1, 1, 1, 2}
      },
      [2] = {
        {0, 1, 0},
        {0, 1, 0},
        {0, 3, 0}
      },
      [3] = {
        {0, 0, 1},
        {0, 0, 1},
        {0, 2, 1}
      },
      [4] = {
        {0, 0, 0, 1, 0},
        {0, 2, 0, 1, 1},
        {0, 0, 1, 1, 1},
      },
      [5] = {
        {0, 2, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 1, 1, 1},
        {0, 0, 1, 1, 0},
        {0, 0, 1, 0, 0}
      },
      [6] = {
        {0, 2, 0},
        {0, 0, 0},
        {0, 1, 0},
        {0, 1, 0},
        {0, 1, 0},
      },
      [7] = {
        {0, 0, 0, 2, 0},
        {0, 0, 0, 0, 0},
        {1, 1, 1, 0, 0},
        {0, 1, 1, 0, 0},
        {0, 0, 1, 0, 0}
      },
      [8] = {
        {0, 0, 0, 2},
        {1, 1, 1, 0}
      },
      [9] = {
        {0, 0, 1, 0},
        {0, 1, 1, 0},
        {1, 1, 1, 2}

      },
      [10] = {
        {0, 1, 0},
        {0, 1, 0},
        {0, 3, 0}
      },
      [11] = {
        {0, 0, 1},
        {0, 0, 1},
        {0, 2, 1},
      },
    }
  },
  [5] = {
    area = {
      [1] = {
        {0, 0, 0, 1, 0},
        {0, 0, 1, 1, 0},
        {0, 1, 1, 1, 0},
        {1, 1, 1, 1, 2}
      },
      [2] = {
        {0, 1, 0},
        {0, 1, 0},
        {0, 1, 0},
        {0, 3, 0}
      },
      [3] = {
        {0, 0, 1},
        {0, 0, 1},
        {0, 0, 1},
        {0, 2, 1}
      },
      [4] = {
        {0, 0, 0, 1, 0, 0},
        {0, 0, 0, 1, 1, 0},
        {0, 2, 0, 1, 1, 1},
        {0, 0, 1, 1, 1, 1},
      },
      [5] = {
        {0, 2, 0, 0, 0, 0},
        {0, 0, 0, 0, 0, 0},
        {0, 0, 1, 1, 1, 1},
        {0, 0, 1, 1, 1, 0},
        {0, 0, 1, 1, 0, 0},
        {0, 0, 1, 0, 0, 0}
      },
      [6] = {
        {0, 2, 0},
        {0, 0, 0},
        {0, 1, 0},
        {0, 1, 0},
        {0, 1, 0},
        {0, 1, 0},
      },
      [7] = {
        {0, 0, 0, 0, 2, 0},
        {0, 0, 0, 0, 0, 0},
        {1, 1, 1, 1, 0, 0},
        {0, 1, 1, 1, 0, 0},
        {0, 0, 1, 1, 0, 0},
        {0, 0, 0, 1, 0, 0},
      },
      [8] = {
        {0, 0, 0, 0, 2},
        {1, 1, 1, 1, 0}
      },
      [9] = {
        {0, 0, 0, 1, 0},
        {0, 0, 1, 1, 0},
        {0, 1, 1, 1, 0},
        {1, 1, 1, 1, 2}

      },
      [10] = {
        {0, 1, 0},
        {0, 1, 0},
        {0, 1, 0},
        {0, 3, 0}
      },
      [11] = {
        {0, 0, 1},
        {0, 0, 1},
        {0, 0, 1},
        {0, 2, 1},
      },
    }

  },

}

spell.combats = {}
for i, config in ipairs(spell.config) do
  table.insert(spell.combats, {})
  for j, area in ipairs(config.area) do
    local combat = Combat()
    combat:setParameter(COMBAT_PARAM_TYPE, COMBAT_PHYSICALDAMAGE)
    combat:setParameter(COMBAT_PARAM_EFFECT, 3)
    combat:setArea(createCombatArea(area))
    function onGetFormulaValues(player, skill, attack, factor)
      local min = ((player:getLevel() + bender_attack['air_tornado'].min) * bender_attack['air_tornado'].min_mult)
      local max = ((player:getLevel() + bender_attack['air_tornado'].max) * bender_attack['air_tornado'].max_mult)
      return -min, -max
    end
    combat:setCallback(CALLBACK_PARAM_SKILLVALUE, "onGetFormulaValues")
    table.insert(spell.combats[i], combat)
  end
end


function onCastSpell(player, var)
  if not player then return false end
  local cid = player:getId()
  local tornado =  getPlayerStorageValue(cid, storage.air_tornado)

  if tornado < 1 then
    tornado = 1
  end

  for i = 1, 8 do
    addEvent(doCombat, (i * 70), cid, spell.combats[tornado][i], var)
  end
  if player:canMove() == true then
    noMove(cid, 0.4, 3)
  end
  doSendAnimatedText("Tornado", getThingPos(cid), TEXTCOLOR_AIR)
  setPlayerStorageValue(cid, storage.air_tornado, tornado%5+1)
  return true
end